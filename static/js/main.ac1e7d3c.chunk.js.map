{"version":3,"sources":["components/creds-prompt/creds-prompt.module.css","components/link-button/link-button.module.css","components/error-div/error-div.module.css","components/main-page/params-table.module.css","components/page/page.module.css","components/link-button/index.tsx","components/error-div/index.tsx","common/helpers.ts","components/creds-prompt/import-aws-creds.tsx","core/use-local-storage.ts","core/use-aws-credentials.ts","components/creds-prompt/index.tsx","components/route-with-credentials/index.tsx","components/page/index.tsx","components/main-page/table.tsx","components/main-page/index.tsx","core/use-aws-parameters-storage.ts","components/app/index.tsx","index.tsx"],"names":["module","exports","LinkButton","children","rest","className","cn","styles","linkButton","ErrorDiv","error","errorDiv","message","maskKey","key","split","map","e","i","length","join","tryCatch","block","catchBlock","r","Promise","catch","readFile","a","window","showOpenFilePicker","multiple","credentialsFileHandler","getFile","credentialsFile","name","Error","ini","text","result","parse","schema","yup","shape","aws_access_key_id","required","aws_secret_access_key","Object","entries","filter","v","isValidSync","entryName","accessKey","secretKey","ImportAwsCredentials","onCredentialsSelected","useState","setError","credentials","setCredentials","useEffect","onImportClick","undefined","size","onClick","getItemSafeSync","value","localStorage","getItem","JSON","console","removeItem","fetcher","useLocalStorage","useSWR","initialData","data","mutate","setValue","newValue","setItem","stringify","removeValue","useAwsCredentials","removeCredentials","CredentialsPage","history","useHistory","location","useLocation","returnTo","state","from","push","span","verticalLine","RouteWithCredentials","to","pathname","PageTemplate","branch","commit","date","shortHash","pageContainer","contentWrapper","footer","dayjs","fromNow","prefixes","truncate","n","s","slice","colorMap","COLOR_SUCCESS","COLOR_WARNING","PrefixRow","paramsForName","Set","Value","colSpan","allTheSameRow","colors","Map","_","reverse","sortBy","countBy","prefix","forGivenPrefix","Name","includes","width","style","backgroundColor","get","list","Prefix","lastIndexOf","replace","ParametersTable","params","useMemo","ps","forEach","p","add","old","set","Array","sort","paramsPrefixes","tomcat","lservice","allapps","MainPage","loading","setLoading","errors","setErrors","ssm","AWS","SSM","region","Credentials","fetchedAt","parameters","refreshParams","flatPrefixes","flatMap","allPrefixes","resolve","page","getParametersByPath","Path","Recursive","WithDecryption","eachPage","err","doneCallback","Parameters","Date","mode","App","path","exact","extend","relativeTime","ReactDOM","render","StrictMode","document","getElementById"],"mappings":"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","file":"static/js/main.ac1e7d3c.chunk.js","sourcesContent":["// extracted by mini-css-extract-plugin\nmodule.exports = {\"verticalLine\":\"creds-prompt_verticalLine__Tx2pu\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"linkButton\":\"link-button_linkButton__2xyCc\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"errorDiv\":\"error-div_errorDiv__1C-Yp\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"allTheSameRow\":\"params-table_allTheSameRow__2SPTF\"};","// extracted by mini-css-extract-plugin\nmodule.exports = {\"wideDiv\":\"page_wideDiv__2inSG\",\"pageContainer\":\"page_pageContainer__sagIe\",\"contentWrapper\":\"page_contentWrapper__3aSSW\",\"footer\":\"page_footer__3hx7W\",\"branch\":\"page_branch__1t1gv\"};","import React, { FC } from 'react';\nimport cn from 'classnames';\nimport styles from './link-button.module.css';\n\nexport const LinkButton: FC<React.ButtonHTMLAttributes<any>> = ({ children, ...rest }) => {\n  return (\n    <button {...rest} className={cn('wt-link', styles.linkButton)}>\n      {children}\n    </button>\n  );\n};\n","import React, { FC } from 'react';\nimport styles from './error-div.module.css';\nimport cn from 'classnames';\n\nexport const ErrorDiv: FC<React.HTMLAttributes<HTMLDivElement> & { error?: Error }> = ({ className, error }) => {\n  if (!error) return null;\n  return <div className={cn(styles.errorDiv, 'wt-text-2', className)}>Error: {error.message}</div>;\n};\n","export const maskKey = (key: string): string => {\n  return key\n    .split('')\n    .map((e, i) => (i < 6 || i > key.length - 4 ? e : '*'))\n    .join('');\n};\n\nexport const tryCatch = (block: () => void | Promise<void>, catchBlock: (e: Error) => void) => {\n  try {\n    const r = block();\n    if (r instanceof Promise) {\n      r.catch(catchBlock);\n    }\n  } catch (e) {\n    catchBlock(e);\n  }\n};\n","import React, { FC, SyntheticEvent, useEffect, useState } from 'react';\nimport { LinkButton } from '../link-button';\nimport { ErrorDiv } from '../error-div';\nimport ini from 'ini';\nimport * as yup from 'yup';\nimport { AwsCredentials } from '../../core/use-aws-credentials';\nimport { List, ListItem } from '@webteam/list';\nimport { maskKey, tryCatch } from '../../common/helpers';\n\ndeclare global {\n  interface Window {\n    showOpenFilePicker: any;\n  }\n}\n\ntype CredentialsFileEntry = {\n  aws_access_key_id: string;\n  aws_secret_access_key: string;\n};\n\ntype NamedAwsCredentials = [string, AwsCredentials];\n\nconst readFile = async (): Promise<NamedAwsCredentials[]> => {\n  const [credentialsFileHandler] = await window.showOpenFilePicker({\n    multiple: false,\n  });\n  const credentialsFile: File = await credentialsFileHandler.getFile();\n  if (credentialsFile.name !== 'credentials') throw new Error(\"File should be named 'credentials'\");\n  const result = ini.parse(await credentialsFile.text());\n  const schema = yup.object().shape({\n    aws_access_key_id: yup.string().required(),\n    aws_secret_access_key: yup.string().required(),\n  });\n  return Object.entries(result)\n    .filter(([, v]) => schema.isValidSync(v))\n    .map(([entryName, { aws_access_key_id, aws_secret_access_key }]: [string, CredentialsFileEntry]) => [\n      entryName,\n      {\n        accessKey: aws_access_key_id,\n        secretKey: aws_secret_access_key,\n      },\n    ]);\n};\n\nexport const ImportAwsCredentials: FC<{ onCredentialsSelected: (credentials: AwsCredentials) => void }> = ({ onCredentialsSelected }) => {\n  const [error, setError] = useState<Error>();\n  const [credentials, setCredentials] = useState<NamedAwsCredentials[]>();\n  useEffect(() => {\n    if (credentials && credentials.length === 1) onCredentialsSelected(credentials[0][1]);\n  }, [credentials, onCredentialsSelected]);\n\n  const onImportClick = async () => {\n    setError(undefined);\n    tryCatch(async () => setCredentials(await readFile()), setError);\n  };\n\n  if (credentials)\n    return (\n      <>\n        <h4 className=\"wt-h4\">Select profile to use:</h4>\n        <div className=\"wt-offset-top-12\" />\n        <List size=\"xs\">\n          {credentials.map(([name, credentials]) => (\n            <ListItem key={name} onClick={() => onCredentialsSelected(credentials)}>\n              {name} ({maskKey(credentials.accessKey)})\n            </ListItem>\n          ))}\n        </List>\n      </>\n    );\n  return (\n    <>\n      <div className=\"wt-text-2\">\n        <LinkButton onClick={onImportClick}>Import</LinkButton> credentials from <strong>~/.aws/credentials</strong>\n        <ErrorDiv className=\"wt-offset-top-12\" error={error} />\n      </div>\n    </>\n  );\n};\n","import useSWR from 'swr/esm';\n\nconst getItemSafeSync = <T>(key: string): T | undefined => {\n  try {\n    const value = localStorage.getItem(key);\n    return value === null ? undefined : JSON.parse(value);\n  } catch (e) {\n    console.error('Failed to read value from local storage', e);\n    localStorage.removeItem(key);\n    return undefined;\n  }\n};\n\nconst fetcher = async (key: string): Promise<any> => getItemSafeSync(key);\n\nexport interface LocalStorageValue<T> {\n  value: T | undefined;\n  setValue: (newValue: T) => void;\n  removeValue: () => void;\n}\n\nexport const useLocalStorage = <T>(key: string): LocalStorageValue<T> => {\n  const { data, mutate } = useSWR<T>(key, fetcher, {\n    initialData: getItemSafeSync(key),\n  });\n  const setValue = (newValue: T) => {\n    localStorage.setItem(key, JSON.stringify(newValue));\n    mutate(newValue).catch(console.error);\n  };\n  const removeValue = () => {\n    localStorage.removeItem(key);\n    mutate(undefined).catch(console.error);\n  };\n  return { value: data, setValue, removeValue };\n};\n","import { useLocalStorage } from './use-local-storage';\n\nexport interface AwsCredentials {\n  accessKey: string;\n  secretKey: string;\n}\n\nexport const useAwsCredentials = () => {\n  const { value, setValue, removeValue } = useLocalStorage<AwsCredentials>('aws-credentials');\n  return { credentials: value, setCredentials: setValue, removeCredentials: removeValue };\n};\n","import React, { FC, useEffect } from 'react';\nimport { Col, Row } from '@webteam/layout';\nimport styles from './creds-prompt.module.css';\nimport { ImportAwsCredentials } from './import-aws-creds';\nimport { AwsCredentials, useAwsCredentials } from '../../core/use-aws-credentials';\nimport { useHistory, useLocation } from 'react-router-dom';\n\nexport const CredentialsPage: FC<{}> = () => {\n  const { credentials, setCredentials } = useAwsCredentials();\n  const history = useHistory();\n  const location = useLocation() as any;\n  const returnTo = location?.state?.from ?? '/';\n  const onCredentialsSelected = (value: AwsCredentials) => {\n    setCredentials(value);\n    history.push(returnTo);\n  };\n  useEffect(() => {\n    if (credentials !== undefined) history.push(returnTo);\n  }, [credentials, history, returnTo]);\n  return (\n    <Row>\n      <Col span={4}>\n        <ImportAwsCredentials onCredentialsSelected={onCredentialsSelected} />\n        {/*<CredentialsManualInput />*/}\n      </Col>\n      <Col span=\"inline\">\n        <div className={styles.verticalLine} />\n      </Col>\n      <Col span=\"inline\">\n        <ul className=\"wt-ul\">\n          <li>Keys will be used for read-only operations</li>\n          <li>Keys will be stored in browser local storage</li>\n          <li>Keys will be used only from this webapp, they are not transferred anywhere</li>\n          <li>You can remove them anytime you want later by clicking 'Sign out' link</li>\n        </ul>\n      </Col>\n    </Row>\n  );\n};\n","import React, { FC } from 'react';\nimport { Redirect, Route, RouteProps } from 'react-router-dom';\nimport { useAwsCredentials } from '../../core/use-aws-credentials';\n\nexport const RouteWithCredentials: FC<RouteProps> = ({ children, ...rest }) => {\n  const { credentials } = useAwsCredentials();\n  return (\n    <Route {...rest}>\n      {({ location }) => {\n        if (credentials === undefined) {\n          return <Redirect to={{ pathname: '/credentials', state: { from: location } }} />;\n        }\n        return children;\n      }}\n    </Route>\n  );\n};\n","import React, { FC } from 'react';\nimport { Hr, LayoutContent, LayoutFooter, LayoutHeader } from '@webteam/layout';\nimport GitInfo from 'react-git-info/macro';\nimport dayjs from 'dayjs';\nimport styles from './page.module.css';\n\nexport const PageTemplate: FC = ({ children }) => {\n  const {\n    branch,\n    commit: { date, shortHash, message },\n  } = GitInfo();\n  return (\n    <div className={styles.pageContainer}>\n      <div className={styles.contentWrapper}>\n        <LayoutHeader>\n          <h1 className=\"wt-h1\">Panamera: parameter naming errors resolution assistant</h1>\n        </LayoutHeader>\n        <LayoutContent className=\"wt-offset-top-24\">{children}</LayoutContent>\n      </div>\n      <LayoutFooter className={styles.footer}>\n        <Hr />\n        <p className=\"wt-text-3\">\n          {shortHash} | <span className={styles.branch}>{branch}</span> | built {dayjs(date).fromNow()} | {message}\n        </p>\n      </LayoutFooter>\n    </div>\n  );\n};\n","import React, { FC, useMemo } from 'react';\nimport { ParameterWithPrefix } from '../../core/use-aws-parameters-storage';\nimport styles from './params-table.module.css';\nimport _ from 'lodash';\nimport { COLOR_SUCCESS, COLOR_WARNING } from '@webteam/colors';\n\nconst prefixes = ['dev1', 'dev2', 'dev3', 'dev4', 'dev5', 'audt', 'stgn/blue', 'stgn/green'];\n\nconst truncate = (n: number, s: string): string => (s.length > n ? s.slice(0, n) + '...' : s);\n\nconst colorMap = [COLOR_SUCCESS, '#9cf55e', '#adee98', '#f5db8d', '#f3c05b', COLOR_WARNING, '#d3a301'];\n\nexport const PrefixRow: FC<{ paramsForName: ParameterWithPrefix[] }> = ({ paramsForName }) => {\n  const isAllTheSame = new Set(paramsForName.map(({ Value }) => Value)).size === 1;\n  if (isAllTheSame)\n    return (\n      <td colSpan={prefixes.length} className={styles.allTheSameRow}>\n        {truncate(64, paramsForName[0].Value!)}\n      </td>\n    );\n  const colors = new Map(_.reverse(_.sortBy(Object.entries(_.countBy(paramsForName, 'Value')), [(e) => e[1]])).map(([v], i) => [v, colorMap[i]]));\n  return (\n    <>\n      {prefixes.map((prefix) => {\n        const forGivenPrefix = paramsForName.filter((e) => e.Name!.includes(prefix));\n        return (\n          <td width={100} key={`${prefix}-value`} style={{ backgroundColor: forGivenPrefix.length === 0 ? '#ea6060' : colors.get(forGivenPrefix[0]?.Value ?? 'fixme') }}>\n            <pre>\n              {forGivenPrefix.length > 0\n                ? forGivenPrefix\n                    .map(({ Value, Prefix }, _, list) =>\n                      list.length > 1\n                        ? `${Prefix\n                            .slice(Prefix.lastIndexOf('/') + 1)\n                            .replace('lservice', 'ls')\n                            .replace('allapps', 'all')}: ${truncate(32, Value!)}`\n                        : truncate(32, Value!),\n                    )\n                    .join('\\n')\n                : '<missing>'}\n            </pre>\n          </td>\n        );\n      })}\n    </>\n  );\n};\n\nexport const ParametersTable: FC<{ params: ParameterWithPrefix[] }> = ({ params }) => {\n  const map = useMemo(() => {\n    const ps = new Set<string>();\n    const r = new Map<string, ParameterWithPrefix[]>();\n    params.forEach((p) => {\n      ps.add(p.Prefix);\n      const name = p.Name!.slice(p.Prefix.length);\n      const old = r.get(name) ?? [];\n      r.set(name, [...old, p]);\n    });\n    return Array.from(r.entries()).sort();\n  }, [params]);\n\n  return (\n    <table className=\"wt-table wt-table_wide wt-table_size_xs\">\n      <thead className=\"wt-text-3\">\n        <tr>\n          <th>Name</th>\n          {prefixes.map((prefix) => (\n            <th key={prefix}>{prefix}</th>\n          ))}\n        </tr>\n      </thead>\n      <tbody className=\"wt-text-3\">\n        {map.map(([name, paramsForName]) => {\n          return (\n            <tr>\n              <td width={400}>{name}</td>\n              <PrefixRow paramsForName={paramsForName} />\n            </tr>\n          );\n        })}\n      </tbody>\n    </table>\n  );\n};\n","import React, { FC, useState } from 'react';\nimport { AwsCredentials, useAwsCredentials } from '../../core/use-aws-credentials';\nimport { maskKey } from '../../common/helpers';\nimport AWS, { AWSError, Credentials } from 'aws-sdk';\nimport { ParameterWithPrefix, useAwsParametersStorage } from '../../core/use-aws-parameters-storage';\nimport dayjs from 'dayjs';\nimport { GetParametersByPathResult, Parameter } from 'aws-sdk/clients/ssm';\nimport { ErrorDiv } from '../error-div';\nimport Button from '@webteam/button';\nimport { ParametersTable } from './table';\n\ninterface Prefix {\n  tomcat: string;\n  lservice: string;\n  allapps: string;\n}\n\nconst paramsPrefixes: Prefix[] = [\n  {\n    tomcat: '/jetprofile-dev1/',\n    lservice: '/jetprofile/dev1/lservice',\n    allapps: '/jetprofile/dev1/allapps',\n  },\n  {\n    tomcat: '/jetprofile-dev2/',\n    lservice: '/jetprofile/dev2/lservice',\n    allapps: '/jetprofile/dev2/allapps',\n  },\n  {\n    tomcat: '/jetprofile-dev3/',\n    lservice: '/jetprofile/dev3/lservice',\n    allapps: '/jetprofile/dev3/allapps',\n  },\n  {\n    tomcat: '/jetprofile-dev4/',\n    lservice: '/jetprofile/dev4/lservice',\n    allapps: '/jetprofile/dev4/allapps',\n  },\n  {\n    tomcat: '/jetprofile-dev5/',\n    lservice: '/jetprofile/dev5/lservice',\n    allapps: '/jetprofile/dev5/allapps',\n  },\n  {\n    tomcat: '/jetprofile-audt/',\n    lservice: '/jetprofile/audt/lservice',\n    allapps: '/jetprofile/audt/allapps',\n  },\n  {\n    tomcat: '/jetprofile-stgn/',\n    lservice: '/jetprofile/stgn/blue/lservice',\n    allapps: '/jetprofile/stgn/blue/allapps',\n  },\n  {\n    tomcat: '/jetprofile-stgn/',\n    lservice: '/jetprofile/stgn/green/lservice',\n    allapps: '/jetprofile/stgn/green/allapps',\n  },\n];\n\nexport const MainPage: FC<{}> = () => {\n  const { credentials, removeCredentials } = useAwsCredentials();\n  const { accessKey, secretKey } = credentials ?? { accessKey: '', secretKey: '' };\n  const [loading, setLoading] = useState<string>();\n  const [errors, setErrors] = useState<AWSError[]>([]);\n  const ssm = new AWS.SSM({ region: 'eu-west-1', credentials: new Credentials(accessKey, secretKey) });\n  const { value, setValue, removeValue } = useAwsParametersStorage();\n  const { fetchedAt, parameters } = value ?? { fetchedAt: undefined, parameters: [] };\n\n  const refreshParams = async () => {\n    const result: ParameterWithPrefix[] = [];\n    const flatPrefixes = paramsPrefixes.flatMap(({ tomcat, allapps, lservice }) => [tomcat, lservice, allapps]);\n    const allPrefixes = new Set(flatPrefixes);\n    setErrors([]);\n    for (const prefix of Array.from(allPrefixes)) {\n      await new Promise((resolve) => {\n        let page = 1;\n        const request = ssm.getParametersByPath({ Path: prefix, Recursive: true, WithDecryption: true });\n        request.eachPage((err: AWSError, data: GetParametersByPathResult, doneCallback) => {\n          setLoading(`prefix '${prefix}' page ${page} (total: ${result.length})`);\n          if (err) setErrors((e) => [...e, err]);\n          if (!doneCallback?.()) {\n            if (data?.Parameters)\n              result.push(\n                ...data?.Parameters.map((e: Parameter) => {\n                  (e as ParameterWithPrefix).Prefix = prefix;\n                  return e as ParameterWithPrefix;\n                }),\n              );\n            page++;\n          }\n          if (data == null) resolve(undefined);\n          return true;\n        });\n      });\n    }\n    setValue({ fetchedAt: new Date(), parameters: result });\n    setLoading(undefined);\n  };\n\n  const onSignOut = () => {\n    removeCredentials();\n    removeValue();\n  };\n\n  return (\n    <>\n      <div className=\"wt-text-2\">\n        Using key: <strong>{maskKey(accessKey)}</strong> | Fetched <strong>{parameters?.length}</strong> parameters <strong>{fetchedAt ? dayjs(fetchedAt).fromNow() : ''}</strong> |{' '}\n        <Button size=\"xs\" mode=\"nude\" onClick={refreshParams}>\n          Refresh\n        </Button>{' '}\n        |{' '}\n        <Button size=\"xs\" mode=\"nude\" onClick={onSignOut}>\n          Sign out\n        </Button>\n      </div>\n      <div className=\"wt-offset-top-12\" />\n      {errors.length > 0 && <ErrorDiv error={new Error(`Got ${errors.length} unexpected error while refreshing params`)} />}\n      {loading === undefined && parameters?.length === 0 && (\n        <p className=\"wt-text-2\">\n          Parameters table is empty, press <strong>Refresh</strong> above to fill it\n        </p>\n      )}\n      {loading && <p className=\"wt-text-2\">Loading {loading}...</p>}\n      {!loading && parameters.length > 0 && <ParametersTable params={parameters} />}\n    </>\n  );\n};\n","import { Parameter } from 'aws-sdk/clients/ssm';\nimport { useLocalStorage } from './use-local-storage';\n\ninterface ParametersStorage {\n  fetchedAt: Date | undefined;\n  parameters: ParameterWithPrefix[];\n}\n\nexport type ParameterWithPrefix = { Prefix: string } & Parameter;\n\nexport const useAwsParametersStorage = () => {\n  return useLocalStorage<ParametersStorage>('aws-params');\n};\n","import React, { FC } from 'react';\nimport '@webteam/typography';\nimport { useAwsCredentials } from '../../core/use-aws-credentials';\nimport { CredentialsPage } from '../creds-prompt';\nimport { Route, Switch } from 'react-router-dom';\nimport { RouteWithCredentials } from '../route-with-credentials';\nimport { PageTemplate } from '../page';\nimport { MainPage } from '../main-page';\n\nexport const App: FC = () => {\n  return (\n    <PageTemplate>\n      <Switch>\n        <Route path=\"/credentials\">\n          <CredentialsPage />\n        </Route>\n        <RouteWithCredentials path=\"/\" exact={true}>\n          <MainPage />\n        </RouteWithCredentials>\n      </Switch>\n    </PageTemplate>\n  );\n};\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport dayjs from 'dayjs';\nimport relativeTime from 'dayjs/plugin/relativeTime';\nimport 'reset-css';\nimport './styles/restore.css';\nimport '@webteam/colors/lib/index.css';\nimport { App } from './components/app';\nimport { HashRouter } from 'react-router-dom';\n\ndayjs.extend(relativeTime);\n\nReactDOM.render(\n  <React.StrictMode>\n    <HashRouter>\n      <App />\n    </HashRouter>\n  </React.StrictMode>,\n  document.getElementById('root'),\n);\n\n// reportWebVitals(console.log);\n"],"sourceRoot":""}